apiVersion: database.oci.upbound.io/v1alpha1
kind: DatabaseDbSystem
metadata:
  annotations:
    meta.upbound.io/example-id: database/v1alpha1/databasedbsystem
  labels:
    testing.upbound.io/example-name: test_db_system
  name: test-db-system
spec:
  forProvider:
    availabilityDomain: ${var.db_system_availability_domain}
    backupNetworkNsgIds: ${var.db_system_backup_network_nsg_ids}
    backupSubnetId: ${oci_core_subnet.test_subnet.id}
    clusterName: ${var.db_system_cluster_name}
    compartmentId: ${var.compartment_id}
    cpuCoreCount: ${var.db_system_cpu_core_count}
    dataCollectionOptions:
    - isDiagnosticsEventsEnabled: ${var.db_system_data_collection_options_is_diagnostics_events_enabled}
      isHealthMonitoringEnabled: ${var.db_system_data_collection_options_is_health_monitoring_enabled}
      isIncidentLogsEnabled: ${var.db_system_data_collection_options_is_incident_logs_enabled}
    dataStoragePercentage: ${var.db_system_data_storage_percentage}
    dataStorageSizeInGb: ${var.db_system_data_storage_size_in_gb}
    databaseEdition: ${var.db_system_database_edition}
    dbHome:
    - database:
      - adminPasswordSecretRef:
          key: example-key
          name: example-secret
          namespace: upbound-system
        backupId: ${oci_database_backup.test_backup.id}
        backupTdePasswordSecretRef:
          key: example-key
          name: example-secret
          namespace: upbound-system
        characterSet: ${var.db_system_db_home_database_character_set}
        databaseId: ${oci_database_database.test_database.id}
        databaseSoftwareImageId: ${oci_database_database_software_image.test_database_software_image.id}
        dbBackupConfig:
        - autoBackupEnabled: ${var.db_system_db_home_database_db_backup_config_auto_backup_enabled}
          autoBackupWindow: ${var.db_system_db_home_database_db_backup_config_auto_backup_window}
          autoFullBackupDay: ${var.db_system_db_home_database_db_backup_config_auto_full_backup_day}
          autoFullBackupWindow: ${var.db_system_db_home_database_db_backup_config_auto_full_backup_window}
          backupDeletionPolicy: ${var.db_system_db_home_database_db_backup_config_backup_deletion_policy}
          backupDestinationDetails:
          - dbrsPolicyId: ${oci_identity_policy.test_policy.id}
            id: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_id}
            isRemote: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_is_remote}
            remoteRegion: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_remote_region}
            type: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_type}
          recoveryWindowInDays: ${var.db_system_db_home_database_db_backup_config_recovery_window_in_days}
          runImmediateFullBackup: ${var.db_system_db_home_database_db_backup_config_run_immediate_full_backup}
        dbDomain: ${var.db_system_db_home_database_db_domain}
        dbName: ${var.db_system_db_home_database_db_name}
        dbWorkload: ${var.db_system_db_home_database_db_workload}
        definedTags: ${var.db_system_db_home_database_defined_tags}
        encryption_key_location_details:
        - hsm_password: ${var.db_system_db_home_database_encryption_key_location_details_hsm_password}
          provider_type: ${var.db_system_db_home_database_encryption_key_location_details_provider_type}
        freeformTags: ${var.db_system_db_home_database_freeform_tags}
        key_store_id: ${oci_database_key_store.test_key_store.id}
        kmsKeyId: ${oci_kms_key.test_key.id}
        kmsKeyVersionId: ${oci_kms_key_version.test_key_version.id}
        ncharacterSet: ${var.db_system_db_home_database_ncharacter_set}
        pdbName: ${var.db_system_db_home_database_pdb_name}
        pluggableDatabases: ${var.db_system_db_home_database_pluggable_databases}
        sid_prefix: ${var.db_system_db_home_database_sid_prefix}
        source_encryption_key_location_details:
        - hsm_password: ${var.db_system_db_home_database_source_encryption_key_location_details_hsm_password}
          provider_type: ${var.db_system_db_home_database_source_encryption_key_location_details_provider_type}
        tdeWalletPasswordSecretRef:
          key: example-key
          name: example-secret
          namespace: upbound-system
        timeStampForPointInTimeRecovery: ${var.db_system_db_home_database_time_stamp_for_point_in_time_recovery}
        vaultId: ${oci_kms_vault.test_vault.id}
      databaseSoftwareImageId: ${oci_database_database_software_image.test_database_software_image.id}
      db_unique_name: ${var.db_unique_name}
      dbVersion: ${var.db_system_db_home_db_version}
      definedTags: ${var.db_system_db_home_defined_tags}
      displayName: ${var.db_system_db_home_display_name}
      freeformTags: ${var.db_system_db_home_freeform_tags}
      isUnifiedAuditingEnabled: ${var.db_system_db_home_is_unified_auditing_enabled}
    dbSystemOptions:
    - storageManagement: ${var.db_system_db_system_options_storage_management}
    definedTags: ${var.db_system_defined_tags}
    diskRedundancy: ${var.db_system_disk_redundancy}
    displayName: ${var.db_system_display_name}
    domain: ${var.db_system_domain}
    faultDomains: ${var.db_system_fault_domains}
    freeformTags:
      Department: Finance
    hostname: ${var.db_system_hostname}
    kmsKeyId: ${oci_kms_key.test_key.id}
    kmsKeyVersionId: ${oci_kms_key_version.test_key_version.id}
    licenseModel: ${var.db_system_license_model}
    maintenanceWindowDetails:
    - customActionTimeoutInMins: ${var.db_system_maintenance_window_details_custom_action_timeout_in_mins}
      daysOfWeek:
      - name: ${var.db_system_maintenance_window_details_days_of_week_name}
      hoursOfDay: ${var.db_system_maintenance_window_details_hours_of_day}
      isCustomActionTimeoutEnabled: ${var.db_system_maintenance_window_details_is_custom_action_timeout_enabled}
      isMonthlyPatchingEnabled: ${var.db_system_maintenance_window_details_is_monthly_patching_enabled}
      leadTimeInWeeks: ${var.db_system_maintenance_window_details_lead_time_in_weeks}
      months:
      - name: ${var.db_system_maintenance_window_details_months_name}
      patchingMode: ${var.db_system_maintenance_window_details_patching_mode}
      preference: ${var.db_system_maintenance_window_details_preference}
      weeksOfMonth: ${var.db_system_maintenance_window_details_weeks_of_month}
    nodeCount: ${var.db_system_node_count}
    nsgIds: ${var.db_system_nsg_ids}
    privateIp: ${var.db_system_private_ip}
    privateIpV6: ${var.db_system_private_ip_v6}
    securityAttributes: ${var.db_system_security_attributes}
    shape: ${var.db_system_shape}
    source: ${var.db_system_source}
    sourceDbSystemId: ${oci_database_db_system.test_db_system.id}
    sparseDiskgroup: ${var.db_system_sparse_diskgroup}
    sshPublicKeys: ${var.db_system_ssh_public_keys}
    storageVolumePerformanceMode: ${var.db_system_storage_volume_performance_mode}
    subnetId: ${oci_core_subnet.test_subnet.id}
    timeZone: ${var.db_system_time_zone}
